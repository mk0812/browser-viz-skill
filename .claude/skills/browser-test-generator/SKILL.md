---
name: browser-test-generator
description: Generate browser automation test scripts (.mjs) for agent-browser with GIF recording and screenshot capture. Use when the user wants to create automated browser tests with visual documentation.
---

# browser-test-generator

agent-browserを使用したブラウザ自動化テストスクリプト（.mjs）を生成するツール。GIF録画とスクリーンショットキャプチャを含む視覚的なテストドキュメントを作成します。

## 機能

- テスト計画からmjsスクリプトを自動生成
- agent-browser CLIを使用したブラウザ操作
- GIF録画による操作フローの記録
- スクリーンショット + アノテーション（赤枠、ズーム）
- ffmpegによる高品質GIF生成

## Prerequisites

- [agent-browser](https://github.com/vercel-labs/agent-browser) がインストールされていること
- ffmpegがインストールされていること（`brew install ffmpeg`）
- Node.js 18+

## テスト計画のフォーマット

テスト計画は以下の形式で記述します：

```yaml
test_name: "タスク追加テスト"
description: "新しいタスクを追加する操作のテスト"
url: "http://localhost:5173"
steps:
  - action: "screenshot"
    name: "initial"
    description: "初期状態"
  - action: "click"
    target: "@e5"
    description: "タイトル入力欄をクリック"
  - action: "type"
    target: "@e5"
    text: "テストタスク"
    description: "タイトルを入力"
  - action: "screenshot"
    name: "after-input"
    highlight: "@e5"
    description: "入力後の状態（入力欄をハイライト）"
  - action: "click"
    target: "@e7"
    description: "追加ボタンをクリック"
  - action: "wait"
    time: 500
  - action: "screenshot"
    name: "result"
    description: "結果確認"
output:
  gif: true
  gif_name: "add-task-flow.gif"
  screenshots_dir: "./test-output"
```

## 生成されるmjsスクリプトの構造

```javascript
/**
 * Test: タスク追加テスト
 * Description: 新しいタスクを追加する操作のテスト
 * Generated by browser-test-generator
 */
import { spawn } from 'child_process';
import { mkdir } from 'fs/promises';

const TEST_NAME = 'add-task';
const OUTPUT_DIR = './test-output';
const FRAMES_DIR = `${OUTPUT_DIR}/${TEST_NAME}-frames`;

// Helper functions
async function agentBrowser(command, args = []) { ... }
async function screenshot(name) { ... }
async function sleep(ms) { ... }
async function generateGif(framesDir, outputName, fps = 3) { ... }

// Main test
async function main() {
  await mkdir(FRAMES_DIR, { recursive: true });

  console.log('Opening page...');
  await agentBrowser('open', ['http://localhost:5173', '--headed']);

  // Test steps...

  console.log('Generating GIF...');
  await generateGif(FRAMES_DIR, `${OUTPUT_DIR}/${TEST_NAME}.gif`);

  console.log('Test completed!');
}

main().catch(console.error);
```

## 使用例

### 1. テスト計画を伝える

```
以下のテスト計画でmjsスクリプトを生成してください：

テスト名: タスク追加テスト
URL: http://localhost:5173
手順:
1. 初期状態をスクリーンショット
2. タイトル入力欄(@e5)をクリック
3. "買い物リスト"と入力
4. 説明欄(@e6)をクリック
5. "牛乳、卵、パン"と入力
6. 入力状態をスクリーンショット（入力欄をハイライト）
7. 追加ボタン(@e7)をクリック
8. 500ms待機
9. 結果をスクリーンショット
10. GIFを生成
```

### 2. 生成されるスクリプトを実行

```bash
node test-add-task.mjs
```

## テストアクション一覧

| アクション | 説明 | パラメータ |
|-----------|------|-----------|
| `open` | ページを開く | url, headed |
| `click` | 要素をクリック | target (ref) |
| `type` | テキストを入力 | target, text |
| `fill` | クリア後に入力 | target, text |
| `screenshot` | スクリーンショット | name, highlight?, zoom? |
| `wait` | 待機 | time (ms) |
| `snapshot` | 要素一覧取得 | - |
| `hover` | ホバー | target |
| `press` | キー押下 | key |

## スクリーンショットオプション

```javascript
// 基本のスクリーンショット
await screenshot('step-1');

// ハイライト付き（赤枠）
await screenshotWithHighlight('step-2', { x: 100, y: 200, width: 300, height: 50 });

// ズーム付き
await screenshotWithZoom('step-3', { x: 100, y: 200, width: 300, height: 50 }, 2);

// ハイライト + ズーム
await screenshotHighlightAndZoom('step-4', box, { scale: 1.5 });
```

## GIF生成オプション

```javascript
// 基本のGIF生成（3fps、ループ）
await generateGif(framesDir, 'output.gif');

// 高品質版（フルサイズ、高画質）
await generateGif(framesDir, 'output-hq.gif', {
  fps: 5,
  quality: 'high',
  scale: '1280:-1'
});
```

## Todo-App用のテスト計画テンプレート

### 1. タスク追加テスト
- 初期状態確認
- タイトル入力
- 説明入力（オプション）
- 追加ボタンクリック
- トースト表示確認
- タスクリスト更新確認

### 2. タスク完了トグルテスト
- 未完了タスクの確認
- チェックボックスクリック
- 完了状態の確認
- トースト表示確認

### 3. タスク編集テスト
- 編集ボタンクリック
- モーダル表示確認
- タイトル編集
- 保存ボタンクリック
- 更新確認

### 4. タスク削除テスト
- 削除ボタンクリック
- 確認モーダル表示
- 削除確認ボタンクリック
- タスク削除確認

### 5. フィルターテスト
- 「すべて」タブ確認
- 「未完了」タブクリック
- フィルター結果確認
- 「完了」タブクリック
- フィルター結果確認

### 6. 検索テスト
- 検索ボックスに入力
- 検索結果確認
- クリアして全件表示確認

## 出力ファイル構成

```
test-output/
├── add-task/
│   ├── frames/
│   │   ├── 001-initial.png
│   │   ├── 002-input.png
│   │   └── 003-result.png
│   ├── add-task.gif
│   └── add-task-hq.gif
├── toggle-task/
│   └── ...
└── ...
```
